stages:
  - integration

print_vars:
  stage: integration
  script:
    - echo "$CI_COMMIT_BRANCH"
    - echo "$CI_COMMIT_REF_NAME"
    - echo "$CI_DEFAULT_BRANCH"
    - echo "$CI_OPEN_MERGE_REQUESTS"
    - echo "$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME"
    - echo "$CI_MERGE_REQUEST_SOURCE_BRANCH_PROTECTED"
    - echo "$CI_MERGE_REQUEST_SOURCE_BRANCH_SHA"
    - echo "$CI_MERGE_REQUEST_TARGET_BRANCH_NAME"
    - echo "$CI_MERGE_REQUEST_TARGET_BRANCH_PROTECTED"
    - echo "$CI_MERGE_REQUEST_TARGET_BRANCH_SHA"
    - echo "$CI_EXTERNAL_PULL_REQUEST_SOURCE_BRANCH_NAME"
    - echo "$CI_EXTERNAL_PULL_REQUEST_SOURCE_BRANCH_SHA"
    - echo "$CI_EXTERNAL_PULL_REQUEST_TARGET_BRANCH_NAME"
    - echo "$CI_EXTERNAL_PULL_REQUEST_TARGET_BRANCH_SHA"
    - echo "GitLab CI/CD | Print all environment variables"
    - env

# AGIFY
micro_agify_develop:
  stage: integration
  trigger:
    include: micro_agify/CI_CD/.agify-develop-pipeline.yml
    #include: micro_agify/CI_CD/.test-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $DEVELOP_BRANCH_NAME
      changes:
        - micro_agify/*

micro_agify_main:
  stage: integration
  trigger:
    include: micro_agify/CI_CD/.agify-main-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $MAIN_BRANCH_NAME
      changes:
        - micro_agify/*

micro_agify_feature:
  stage: integration
  trigger:
    include: micro_agify/CI_CD/.agify-feature-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH =~ /^(?i)(feature|feat)(.*)/
      changes:
        - micro_agify/*

micro_agify_mr:
  stage: integration
  trigger:
    include: micro_agify/CI_CD/.test-pipeline.yml

# GENDERIZE
micro_genderize_develop:
  stage: integration
  trigger:
    include: micro_genderize/CI_CD/.genderize-develop-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $DEVELOP_BRANCH_NAME
      changes:
        - micro_genderize/*

micro_genderize_main:
  stage: integration
  trigger:
    include: micro_genderize/CI_CD/.genderize-main-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $MAIN_BRANCH_NAME
      changes:
        - micro_genderize/*

# MIDDLEWARE
micro_middleware_develop:
  stage: integration
  trigger:
    include: middleware/CI_CD/.middleware-develop-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $DEVELOP_BRANCH_NAME
      changes:
        - middleware/*

micro_middleware_main:
  stage: integration
  trigger:
    include: middleware/CI_CD/.middleware-main-pipeline.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $MAIN_BRANCH_NAME
      changes:
        - middleware/*
